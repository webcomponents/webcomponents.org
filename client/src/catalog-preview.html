<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="catalog-styles.html">

<script src='https://www.google.com/recaptcha/api.js'></script>

<dom-module id="catalog-preview">
  <template>
    <style include="catalog-styles"></style>

    <style>
      .main-content h1 {
        margin: 32px 0 16px;
      }

      .g-recaptcha {
        margin: 16px 0;
      }

      @media (max-width: 500px), (max-height: 500px) {
        #container {
          padding: 16px;
        }
      }

    </style>

    <iron-ajax
      id="ajax"
      method="POST"
      url="[[baseUrls.api]]/api/ondemand"
      handle-as="text"
      on-response="_taskTriggered"
      on-error="_error"></iron-ajax>

    <div id="container">
      <h3>Preview</h3>
      <h1 class="page-title">Preview element</h1>
      <h2 class="page-subtitle">Preview allows you to view what you element would look like without publishing it. Simply enter any  full Github URL, including pull requests, commits, or branches.</h2>

      <div class="main-content">
        <h1>Enter a Github URL</h1>
        <input type="text" name="url" value="{{url::input}}" placeholder="Any Github URL">
        <div class="g-recaptcha" data-sitekey="6LcCRSgTAAAAAGhe5bUDS5lVHAPNN2cY7xo-Zk5f"></div>
        <button on-tap="onSubmit">Preview</button>
      </div>
    </div>

  </template>

  <script>
    Polymer({

      is: 'catalog-preview',

      properties: {
        baseUrls: Object,

        _sha: String,
      },

      onSubmit: function() {
        if (!grecaptcha || !grecaptcha.getResponse())
          return;

        this.$.ajax.params = {
          url: this.url,
          recaptcha: grecaptcha.getResponse()
        };
        this.$.ajax.generateRequest();
      },

      _taskTriggered: function(event) {
        window.location = 'element/' + event.detail.response;
      },

      _error: function() {
        console.log('An error occured. Please try again.');
      },

    });
  </script>
</dom-module>
