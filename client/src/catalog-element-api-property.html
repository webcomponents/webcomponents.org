<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/marked-element/marked-element.html">

<dom-module id="catalog-element-api-property">
  <template>
    <div id="signature">
      <a id$="[[anchorId]]" href$="#[[anchorId]]" class="name deeplink">{{descriptor.name}}</a><span class="params">(<span>{{_paramText}}</span>)</span>
      <span class="return" hidden$="{{!descriptor.return}}">➙ <span class="type">{{descriptor.return.type}}</span></span>
    </div>
    <div id="details">
      <div id="meta" hidden$="{{_computeHideMeta(descriptor)}}">
        <span id="type" class="type">{{descriptor.type}}</span>
        <span class="annotation">[[_getAnnotation(descriptor)]]</span>
      </div>
      <ol id="params" hidden$="{{_computeHideParams(descriptor,return)}}">
        <template is="dom-repeat" items="{{descriptor.params}}">
          <li hidden$="{{!item.type}}">
            <span class="name">{{item.name}}</span>
            <span class="type">{{item.type}}</span>
            <marked-element markdown="{{item.desc}}">
              <div class="markdown-html"></div>
            </marked-element>
          </li>
        </template>
        <li class="return" hidden$="{{!descriptor.return}}">Returns
          <span class="type">{{descriptor.return.type}}</span>
          <marked-element markdown="{{descriptor.return.desc}}">
            <div class="markdown-html"></div>
          </marked-element>
        </li>
      </ol>
      <marked-element id="desc" markdown="{{descriptor.desc}}" hidden$="{{!descriptor.desc}}">
        <div class="markdown-html"></div>
      </marked-element>
    </div>
  </template>

  <script>
    Polymer({
      is: 'catalog-element-api-property',

      properties: {
        descriptor: {
          type:     Object,
          observer: '_descriptorChanged',
        },

        /**
         * Unique anchor ID for deep-linking.
         */
        anchorId: {
          type: String,
          reflectToAttribute: true,
        },

        _paramText: String,
      },

      ready: function() {
        this._isReady = true;
      },

      _descriptorChanged: function() {
        this.toggleAttribute('configuration', this.descriptor.configuration);
        this.toggleAttribute('function',      this.descriptor.function);
        this._paramText = (this.descriptor.params || []).map(function(param) {
          return param.name;
        }).join(', ');
      },

      // hidden if no type and no defaults
      _computeHideMeta: function(descriptor) {
        return descriptor.type === undefined &&  descriptor.default === undefined;
      },

      // hidden if no params, and no return value
      _computeHideParams: function(descriptor,ret) {
        return (!descriptor.params || descriptor.params.length === 0) && !ret;
      },

      _computeHideDefault: function(def) {
        return def === undefined;
      },

      _computeDefaultDisplay: function(def) {
        if (def === '')
          return "''";
        return def;
      },

      _getAnnotation: function(descriptor) {
        var annotations = [];

        if (descriptor['default'] !== undefined) {
          annotations.push('Default: ' + descriptor['default']);
        }
        if (descriptor.readOnly) {
          annotations.push('readOnly');
        }
        if (descriptor.notify) {
          annotations.push('notifies');
        }
        return annotations.join(' – ');
      }
    });
  </script>
</dom-module>
